{% extends "layout.html" %}

{% block body %}
<style>
    .tableIMG {
        object-fit: cover;
        height: 3vw;
        width: 2vw;

    }

    .maxWidth {
        max-width: 80%;
    }

    .avatar-small {
        width: 150px;
        border-radius: 60%;
    }

    .big-text {
        scale: 400%;
    }
</style>

<div class="container">

    <h3 class="row justify-content-center">Anilist Profile Comparator</h1>

    <div class="row justify-content-center">

        <div class="col-2">

            <div class="row text-center">
                <h4>{{data['u1']['name']}}</h4>
            </div>

            <div class="row d-flex justify-content-center">
                <img src={{data['u1']["avatar"]['medium']}} class="img-fluid avatar-small">
            </div>
        </div>

        <div class="col-auto">
            <table class="table-dark table-sm small">
                <tr>
                    <th>TOTAL</th>
                    <th>{{data['u1']['total']}}</th>
                </tr>
                <tr>
                    <th>COMPLETED</th>
                    <th>{{data['u1']['completed']}}</th>
                </tr>
                <tr>
                    <th>WATCHING</th>
                    <th>{{data['u1']['current']}}</th>
                </tr>
                <tr>
                    <th>PLANNING</th>
                    <th>{{data['u1']['planning']}}</th>
                </tr>
                <tr>
                    <th>DROPPED</th>
                    <th>{{data['u1']['dropped']}}</th>
                </tr>
            </table>
        </div>

        <div class="col-2">

            <div class="d-flex justify-content-center text-center">
                <h4>Match</h4>
            </div>

            <br>

            <div class="d-flex justify-content-center">
                <p class="big-text">{{data['overlap']}}%</p>
            </div>

        </div>

        <div class="col-auto text-end">
            <table class="table-dark table-sm small">
                <tr>
                    <th>{{data['u2']['total']}}</th>
                    <th>TOTAL</th>
                </tr>
                <tr>
                    <th>{{data['u2']['completed']}}</th>
                    <th>COMPLETED</th>
                </tr>
                <tr>
                    <th>{{data['u2']['current']}}</th>
                    <th>WATCHING</th>
                </tr>
                <tr>
                    <th>{{data['u2']['planning']}}</th>
                    <th>PLANNING</th>
                </tr>
                <tr>
                    <th>{{data['u2']['dropped']}}</th>
                    <th>DROPPED</th>
                </tr>
            </table>
        </div>

        <div class="col-2">

            <div class="row text-center">
                <h4>{{data['u2']['name']}}</h4>
            </div>

            <div class="row d-flex justify-content-center">
                <img src={{data['u2']["avatar"]['medium']}} class="img-fluid avatar-small">
            </div>

        </div>

    </div>


    <h3 class="row justify-content-center">highest time spent on anime</h3>

    <div class="row justify-content-center mb-2">

        <div class="col-auto">
            <div class="row">
                <table class="table-responsive-md table-dark table-sm text-wrap">
                    {% for media in data['l1']%}
                    <tr>
                        <th><img src={{media["cover"]}} class="img-fluid rounded tableIMG"></th>
                        <th>{{media['title']}}</th>
                        <th>{{media['time_spent']}}</th>
                    </tr>
                    {% endfor %}
                </table>
            </div>
        </div>

        <div class="col-auto">
            <div class="row">
                <table class="table-responsive-md table-dark table-sm text-wrap">
                    {% for media in data['l2']%}
                    <tr>
                        <th>{{media['time_spent']}}</th>
                        <th>{{media['title']}}</th>
                        <th><img src={{media["cover"]}} class="img-fluid rounded tableIMG"></th>
                    </tr>
                    {% endfor %}
                </table>
            </div>
        </div>
    </div>

    <h3 class="row justify-content-center">genres</h3>

    <div class="row d-flex justify-content-center">
        <div class="col-4 p-0">
            <canvas id="barchart"></canvas>
        </div>
        <div class="col-4 p-0">
            <canvas id="barchart2"></canvas>
        </div>
    </div>

    {% if data['common_favs']['anime'] %}
    <h5 class="row d-flex justify-content-center">Common favourite anime</h5>
    <div class="'row d-flex justify-content-center text-center">
        {% for fav in data['common_favs']['anime'] %}
        <div class="col">{{fav['title']}}</div>
        {% endfor %}
    </div>
    {% endif %}

    {% if data['common_favs']['staff'] %}
    <h5 class="row d-flex justify-content-center">Common favourite characters</h5>
    <div class="'row d-flex justify-content-center text-center">
        {% for fav in data['common_favs']['characters'] %}
        <div class="col">{{fav['name']}}</div>
        {% endfor %}
    </div>
    {% endif %}

    {% if data['common_favs']['staff'] %}
    <h5 class="row d-flex justify-content-center">Common favourite staff</h5>
    <div class="'row d-flex justify-content-center text-center">
        {% for fav in data['common_favs']['staff'] %}
        <div class="col">{{fav['name']}}</div>
        {% endfor %}
    </div>
    {% endif %}

    {% if data['common_favs']['studios'] %}
    <h5 class="row d-flex justify-content-center">Common favourite studios</h5>
    <div class="'row d-flex justify-content-center text-center">
        {% for fav in data['common_favs']['studios'] %}
        <div class="col">{{fav['name']}}</div>
        {% endfor %}
    </div>
    {% endif %}
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>

<script>
    const ctx = document.getElementById('barchart');

    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: [{% for genre in data['u1']['statistics']['anime']['genres'] %}'{{genre['genre']}}'{% if loop.index < 7 %}, {% endif %}{% endfor %}],
        datasets: [{
            label: 'count',
            data: [{% for genre in data['u1']['statistics']['anime']['genres'] %}{{ genre['count']}}{% if loop.index < 7 %}, {% endif %} {% endfor %}],
    borderWidth: 1
      }]
    },
    plugins: [ChartDataLabels],
        options: {
        plugins: {
            legend: {
                display: false
            },
            datalabels: {
                color: '#76FEC5'
            }
        },
        indexAxis: 'y',
            scales: {
            y: {
                beginAtZero: true
            }
        }
    }
  });
</script>

<script>
    const ctx2 = document.getElementById('barchart2');

    new Chart(ctx2, {
        type: 'bar',
        data: {
            labels: [{% for genre in data['u2']['statistics']['anime']['genres'] %}'{{genre['genre']}}'{% if loop.index < 7 %}, {% endif %}{% endfor %}],
        datasets: [{
            label: 'count',
            data: [{% for genre in data['u2']['statistics']['anime']['genres'] %}{{ genre['count']}}{% if loop.index < 7 %}, {% endif %} {% endfor %}],
    borderWidth: 1
      }]
    },
    plugins: [ChartDataLabels],
        options: {
        plugins: {
            legend: {
                display: false
            },
            datalabels: {
                color: '#76FEC5'
            }
        },
        indexAxis: 'y',
            scales: {
            y: {
                position: 'right',
                    beginAtZero: true
            },
            x: {
                reverse: true
            }
        },
    }
  });
</script>

{% endblock %}